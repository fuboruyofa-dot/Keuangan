<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DompetKu ‚Äî Personal Finance</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
<style>
:root {
  --teal: #0ab68b;
  --teal2: #07c8a0;
  --teal-dark: #068a6a;
  --teal-soft: rgba(10,182,139,.1);
  --teal-glow: rgba(10,182,139,.25);
  --bg: #f0faf7;
  --bg2: #e8f6f1;
  --surface: rgba(255,255,255,0.82);
  --surface2: rgba(255,255,255,0.55);
  --border: rgba(10,182,139,.12);
  --border2: rgba(255,255,255,0.7);
  --text: #0d2b22;
  --text2: #3d7065;
  --muted: #7eaaa0;
  --income: #0ab68b;
  --expense: #f04e6e;
  --saving: #7c5cfc;
  --lifestyle: #ff7d45;
  --daily: #2196f3;
  --play: #e91e8c;
  --sidebar-w: 220px;
  --r: 20px;
  --rs: 13px;
  --shadow: 0 4px 24px rgba(10,182,139,.08);
  --shadow-md: 0 8px 40px rgba(10,182,139,.14);
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Plus Jakarta Sans', sans-serif;
  background: var(--bg);
  min-height: 100vh;
  color: var(--text);
  overflow-x: hidden;
}

/* Mesh background */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    radial-gradient(ellipse 60% 50% at 20% 10%, rgba(10,182,139,.12) 0%, transparent 70%),
    radial-gradient(ellipse 50% 60% at 85% 80%, rgba(124,92,252,.08) 0%, transparent 70%),
    radial-gradient(ellipse 40% 40% at 60% 40%, rgba(255,125,69,.05) 0%, transparent 70%);
  pointer-events: none;
  z-index: 0;
}

::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--teal); border-radius: 10px; opacity:.5; }

/* ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ */
.sb {
  position: fixed; left: 0; top: 0; bottom: 0;
  width: var(--sidebar-w);
  background: var(--surface);
  backdrop-filter: blur(32px) saturate(1.4);
  border-right: 1px solid var(--border2);
  display: flex; flex-direction: column;
  padding: 0; z-index: 200;
  transition: transform .3s cubic-bezier(.4,0,.2,1);
  box-shadow: 4px 0 32px rgba(10,182,139,.06);
}

.sb-logo {
  padding: 28px 20px 24px;
  display: flex; align-items: center; gap: 11px;
  border-bottom: 1px solid var(--border);
}
.sb-logo-mark {
  width: 38px; height: 38px;
  border-radius: 12px;
  background: linear-gradient(135deg, var(--teal-dark), var(--teal2));
  display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem;
  box-shadow: 0 4px 16px var(--teal-glow);
  flex-shrink: 0;
}
.sb-logo-text {
  font-size: 1.1rem; font-weight: 800; color: var(--text);
  letter-spacing: -.02em;
}
.sb-logo-text em { color: var(--teal); font-style: normal; }

.sb-nav { padding: 16px 12px; flex: 1; }
.sb-section { font-size: .65rem; font-weight: 700; letter-spacing: .12em; text-transform: uppercase; color: var(--muted); padding: 12px 10px 6px; }

.sb-item {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 12px; margin-bottom: 2px;
  border-radius: 12px;
  cursor: pointer; color: var(--muted);
  font-size: .845rem; font-weight: 500;
  transition: all .18s;
  user-select: none;
  position: relative;
}
.sb-item:hover { background: var(--teal-soft); color: var(--teal-dark); }
.sb-item.active {
  background: linear-gradient(135deg, rgba(10,182,139,.18), rgba(10,182,139,.06));
  color: var(--teal-dark); font-weight: 700;
  box-shadow: inset 0 0 0 1px rgba(10,182,139,.2);
}
.sb-item.active::before {
  content: '';
  position: absolute; left: 0; top: 20%; bottom: 20%;
  width: 3px; border-radius: 0 3px 3px 0;
  background: var(--teal);
  left: -12px;
}
.sb-icon { font-size: .95rem; width: 22px; text-align: center; flex-shrink: 0; }

.sb-bottom {
  padding: 14px 12px 20px;
  border-top: 1px solid var(--border);
}
.user-card {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 12px;
  background: var(--teal-soft);
  border-radius: 14px;
  border: 1px solid var(--border);
  cursor: pointer;
  transition: background .18s;
}
.user-card:hover { background: rgba(10,182,139,.15); }
.avatar {
  width: 34px; height: 34px; border-radius: 50%;
  background: linear-gradient(135deg, var(--teal-dark), var(--teal2));
  display: flex; align-items: center; justify-content: center;
  color: white; font-weight: 800; font-size: .78rem;
  flex-shrink: 0; box-shadow: 0 2px 8px var(--teal-glow);
}
.user-name { font-size: .82rem; font-weight: 700; color: var(--text); }
.user-role { font-size: .7rem; color: var(--muted); }

/* ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ */
.main {
  margin-left: var(--sidebar-w);
  padding: 32px 28px;
  min-height: 100vh;
  position: relative; z-index: 1;
}

/* ‚îÄ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ‚îÄ */
.topbar {
  display: flex; align-items: flex-start; justify-content: space-between;
  margin-bottom: 28px; gap: 16px; flex-wrap: wrap;
}
.topbar-left { }
.greeting {
  font-size: .78rem; color: var(--muted); font-weight: 500;
  margin-bottom: 3px;
}
.page-title {
  font-family: 'Instrument Serif', serif;
  font-size: 2.1rem; color: var(--text);
  line-height: 1.1; letter-spacing: -.02em;
}
.topbar-right { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }

/* PERIOD TABS */
.period-tabs {
  display: flex;
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: 12px;
  padding: 3px;
  backdrop-filter: blur(16px);
}
.ptab {
  padding: 7px 16px; border-radius: 9px;
  font-size: .78rem; font-weight: 600; cursor: pointer;
  color: var(--muted); transition: all .2s;
  letter-spacing: -.01em;
}
.ptab.active {
  background: white; color: var(--teal-dark);
  box-shadow: 0 2px 12px rgba(10,182,139,.15);
}

/* BUTTONS */
.btn {
  display: inline-flex; align-items: center; gap: 7px;
  padding: 10px 18px; border-radius: 12px;
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: .82rem; font-weight: 700;
  cursor: pointer; border: none; transition: all .2s;
  letter-spacing: -.01em;
}
.btn-primary {
  background: linear-gradient(135deg, var(--teal-dark) 0%, var(--teal2) 100%);
  color: white;
  box-shadow: 0 4px 20px var(--teal-glow);
}
.btn-primary:hover { transform: translateY(-1px); box-shadow: 0 8px 28px var(--teal-glow); }
.btn-primary:active { transform: translateY(0); }
.btn-ghost {
  background: var(--surface);
  border: 1px solid var(--border2);
  color: var(--text2);
  backdrop-filter: blur(10px);
}
.btn-ghost:hover { background: white; }
.btn-sm { padding: 7px 13px; font-size: .76rem; }

/* ‚îÄ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ‚îÄ */
.stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 20px; }

.stat-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: var(--r);
  padding: 20px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(24px);
  transition: transform .2s, box-shadow .2s;
  animation: fadeSlideIn .5s ease backwards;
}
.stat-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }
.stat-card:nth-child(1) { animation-delay: .05s; }
.stat-card:nth-child(2) { animation-delay: .1s; }
.stat-card:nth-child(3) { animation-delay: .15s; }
.stat-card:nth-child(4) { animation-delay: .2s; }

@keyframes fadeSlideIn {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}

.stat-icon-wrap {
  width: 40px; height: 40px; border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem; margin-bottom: 14px;
}
.stat-label { font-size: .7rem; font-weight: 700; text-transform: uppercase; letter-spacing: .1em; color: var(--muted); margin-bottom: 5px; }
.stat-value { font-size: 1.35rem; font-weight: 800; color: var(--text); letter-spacing: -.02em; line-height: 1; }
.stat-badge {
  display: inline-flex; align-items: center; gap: 3px;
  padding: 3px 8px; border-radius: 20px;
  font-size: .68rem; font-weight: 700; margin-top: 7px;
}
.badge-green { background: rgba(10,182,139,.12); color: var(--income); }
.badge-red { background: rgba(240,78,110,.1); color: var(--expense); }
.badge-purple { background: rgba(124,92,252,.1); color: var(--saving); }

/* ‚îÄ‚îÄ‚îÄ MAIN GRID ‚îÄ‚îÄ‚îÄ */
.main-grid { display: grid; grid-template-columns: 1.55fr 1fr; gap: 18px; margin-bottom: 20px; }

/* ‚îÄ‚îÄ‚îÄ HERO BALANCE CARD ‚îÄ‚îÄ‚îÄ */
.hero-card {
  background: linear-gradient(135deg, #0a3d2e 0%, var(--teal-dark) 50%, var(--teal) 100%);
  border-radius: var(--r);
  padding: 26px;
  color: white;
  position: relative;
  overflow: hidden;
  margin-bottom: 16px;
  box-shadow: 0 12px 48px rgba(10,182,139,.3);
  animation: fadeSlideIn .4s ease backwards;
}
.hero-card::before {
  content: '';
  position: absolute;
  top: -60px; right: -60px;
  width: 220px; height: 220px;
  border-radius: 50%;
  background: rgba(255,255,255,.06);
}
.hero-card::after {
  content: '';
  position: absolute;
  bottom: -80px; left: -20px;
  width: 260px; height: 260px;
  border-radius: 50%;
  background: rgba(255,255,255,.04);
}
.hero-label { font-size: .73rem; opacity: .72; font-weight: 500; margin-bottom: 6px; }
.hero-amount {
  font-family: 'Instrument Serif', serif;
  font-size: 2.4rem; font-weight: 400;
  margin-bottom: 3px;
  position: relative; z-index: 1;
  letter-spacing: -.02em;
}
.hero-date { font-size: .72rem; opacity: .55; margin-bottom: 20px; }
.hero-stats { display: flex; gap: 28px; position: relative; z-index: 1; }
.hero-stat-label { font-size: .68rem; opacity: .65; margin-bottom: 3px; }
.hero-stat-val { font-size: .95rem; font-weight: 700; }
.acc-pills { display: flex; gap: 7px; flex-wrap: wrap; margin-top: 18px; position: relative; z-index: 1; }
.acc-pill {
  padding: 5px 13px;
  background: rgba(255,255,255,.15);
  border: 1px solid rgba(255,255,255,.2);
  border-radius: 20px;
  font-size: .72rem; font-weight: 600;
  cursor: pointer; transition: background .18s;
  backdrop-filter: blur(6px);
}
.acc-pill:hover { background: rgba(255,255,255,.25); }

/* ‚îÄ‚îÄ‚îÄ CHART CARD ‚îÄ‚îÄ‚îÄ */
.card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: var(--r);
  padding: 20px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(24px);
  animation: fadeSlideIn .45s ease .15s backwards;
}
.card-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 18px;
}
.card-title { font-size: .75rem; font-weight: 700; text-transform: uppercase; letter-spacing: .1em; color: var(--muted); }
.card-action { font-size: .75rem; color: var(--teal); font-weight: 600; cursor: pointer; }
.card-action:hover { text-decoration: underline; }

/* Mini chart */
.chart-wrap { display: flex; align-items: flex-end; gap: 6px; height: 68px; }
.chart-bar-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 5px; }
.chart-bar {
  width: 100%; border-radius: 6px 6px 0 0;
  transition: height .7s cubic-bezier(.4,0,.2,1), opacity .2s;
  cursor: pointer; position: relative;
  min-height: 3px;
}
.chart-bar:hover { opacity: .75; }
.chart-bar-label { font-size: .6rem; color: var(--muted); font-weight: 600; }

/* ‚îÄ‚îÄ‚îÄ RIGHT COLUMN ‚îÄ‚îÄ‚îÄ */
.right-col { display: flex; flex-direction: column; gap: 16px; }

/* ‚îÄ‚îÄ‚îÄ TRANSACTIONS ‚îÄ‚îÄ‚îÄ */
.tx-item {
  display: flex; align-items: center; gap: 12px;
  padding: 11px 0;
  border-bottom: 1px solid var(--border);
  transition: all .15s;
}
.tx-item:last-child { border-bottom: none; }
.tx-icon-wrap {
  width: 38px; height: 38px; border-radius: 11px;
  display: flex; align-items: center; justify-content: center;
  font-size: .9rem; flex-shrink: 0;
}
.tx-body { flex: 1; min-width: 0; }
.tx-name { font-size: .84rem; font-weight: 600; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.tx-meta { font-size: .7rem; color: var(--muted); margin-top: 2px; display: flex; gap: 7px; align-items: center; }
.tx-cat-tag { padding: 2px 7px; border-radius: 8px; font-size: .65rem; font-weight: 700; background: var(--teal-soft); color: var(--teal-dark); }
.tx-right { text-align: right; flex-shrink: 0; }
.tx-amount { font-size: .9rem; font-weight: 800; letter-spacing: -.01em; }
.tx-time { font-size: .67rem; color: var(--muted); margin-top: 2px; }

/* ‚îÄ‚îÄ‚îÄ BUDGET BARS ‚îÄ‚îÄ‚îÄ */
.budget-row { margin-bottom: 15px; }
.budget-row:last-child { margin-bottom: 0; }
.budget-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 7px; }
.budget-cat { display: flex; align-items: center; gap: 8px; font-size: .82rem; font-weight: 600; }
.budget-dot { width: 9px; height: 9px; border-radius: 50%; flex-shrink: 0; }
.budget-pct { font-size: .75rem; font-weight: 700; }
.budget-track { height: 6px; background: rgba(10,182,139,.1); border-radius: 10px; overflow: hidden; }
.budget-fill { height: 100%; border-radius: 10px; transition: width 1s cubic-bezier(.4,0,.2,1); }
.budget-foot { display: flex; justify-content: space-between; margin-top: 4px; font-size: .68rem; color: var(--muted); }

/* ‚îÄ‚îÄ‚îÄ NOTIF ‚îÄ‚îÄ‚îÄ */
.notif-item {
  display: flex; align-items: flex-start; gap: 10px;
  padding: 10px 12px;
  background: rgba(255,255,255,.6);
  border-radius: 12px;
  border: 1px solid var(--border);
  margin-bottom: 7px;
}
.notif-item:last-child { margin-bottom: 0; }
.notif-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; margin-top: 5px; }
.notif-text { font-size: .8rem; font-weight: 600; }
.notif-sub { font-size: .7rem; color: var(--muted); margin-top: 2px; }

/* ‚îÄ‚îÄ‚îÄ BOTTOM GRID ‚îÄ‚îÄ‚îÄ */
.bottom-grid { display: grid; grid-template-columns: 1fr; gap: 18px; }

/* ‚îÄ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ‚îÄ */
.page { display: none; }
.page.active { display: block; }

/* ‚îÄ‚îÄ‚îÄ ACCOUNTS PAGE ‚îÄ‚îÄ‚îÄ */
.accs-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
.acc-card-big {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: var(--r);
  padding: 22px;
  box-shadow: var(--shadow);
  display: flex; align-items: center; gap: 16px;
  transition: transform .2s, box-shadow .2s;
  animation: fadeSlideIn .4s ease backwards;
}
.acc-card-big:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }
.acc-logo-big { width: 50px; height: 50px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; flex-shrink: 0; }
.acc-card-name { font-size: .9rem; font-weight: 800; color: var(--text); }
.acc-card-num { font-size: .72rem; color: var(--muted); margin-top: 2px; }
.acc-card-bal { font-size: 1.1rem; font-weight: 800; margin-left: auto; text-align: right; letter-spacing: -.02em; }
.acc-card-type { font-size: .68rem; color: var(--muted); text-align: right; margin-top: 2px; }

/* ‚îÄ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ */
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(10,40,32,.35);
  backdrop-filter: blur(8px);
  z-index: 500; display: none;
  align-items: center; justify-content: center;
  padding: 20px;
}
.modal-overlay.show { display: flex; }
.modal {
  background: white;
  border-radius: 24px;
  width: 100%; max-width: 460px;
  box-shadow: 0 24px 80px rgba(10,182,139,.2);
  overflow: hidden;
  animation: modalIn .3s cubic-bezier(.4,0,.2,1);
}
@keyframes modalIn {
  from { opacity: 0; transform: translateY(24px) scale(.97); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}
.modal-header {
  padding: 22px 24px 0;
  display: flex; align-items: center; justify-content: space-between;
}
.modal-title { font-size: 1.15rem; font-weight: 800; color: var(--text); letter-spacing: -.02em; }
.modal-close {
  width: 30px; height: 30px; border-radius: 50%;
  background: rgba(10,182,139,.08); border: none; cursor: pointer;
  font-size: 1rem; color: var(--muted);
  display: flex; align-items: center; justify-content: center;
  transition: all .18s;
}
.modal-close:hover { background: rgba(240,78,110,.1); color: var(--expense); }
.modal-body { padding: 20px 24px 24px; }

/* Form */
.form-group { margin-bottom: 15px; }
.form-label { font-size: .72rem; font-weight: 700; text-transform: uppercase; letter-spacing: .08em; color: var(--muted); margin-bottom: 6px; display: block; }
.form-input, .form-select {
  width: 100%; padding: 11px 14px;
  border: 1.5px solid #e5f0ee;
  border-radius: 12px;
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: .88rem; color: var(--text);
  background: white; outline: none; transition: border .18s, box-shadow .18s;
}
.form-input:focus, .form-select:focus {
  border-color: var(--teal);
  box-shadow: 0 0 0 3px rgba(10,182,139,.1);
}
.type-toggle { display: flex; gap: 8px; margin-bottom: 15px; }
.type-btn {
  flex: 1; padding: 11px; border-radius: 12px;
  border: 1.5px solid #e5f0ee;
  background: white; cursor: pointer;
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: .84rem; font-weight: 700;
  text-align: center; transition: all .18s; color: var(--muted);
}
.type-btn.income.active { border-color: var(--income); background: rgba(10,182,139,.07); color: var(--income); }
.type-btn.expense.active { border-color: var(--expense); background: rgba(240,78,110,.07); color: var(--expense); }
.datetime-box { padding: 11px 14px; border: 1.5px solid #e5f0ee; border-radius: 12px; font-size: .82rem; color: var(--muted); background: #f9fdfb; }

/* Filter row */
.filter-row { display: flex; gap: 10px; margin-bottom: 16px; flex-wrap: wrap; align-items: center; }
.search-wrap {
  flex: 1; min-width: 180px;
  display: flex; align-items: center; gap: 8px;
  padding: 8px 14px;
  background: var(--surface); border: 1px solid var(--border2);
  border-radius: 12px; backdrop-filter: blur(10px);
}
.search-wrap input { border: none; background: transparent; font-family: 'Plus Jakarta Sans', sans-serif; font-size: .82rem; color: var(--text); outline: none; flex: 1; }
.filter-sel {
  padding: 8px 13px; border: 1px solid var(--border2);
  border-radius: 12px; font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: .78rem; color: var(--text);
  background: var(--surface); backdrop-filter: blur(10px); outline: none; cursor: pointer;
  transition: border .18s;
}
.filter-sel:focus { border-color: var(--teal); }

/* Budget page */
.budget-page-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-bottom: 20px; }

/* Saving page */
.saving-stats { display: grid; grid-template-columns: repeat(3,1fr); gap: 14px; margin-bottom: 20px; }

/* Empty */
.empty { text-align: center; padding: 36px 20px; color: var(--muted); }
.empty-icon { font-size: 2.2rem; margin-bottom: 10px; }
.empty-text { font-size: .85rem; }

/* Hamburger */
.hamburger {
  display: none; position: fixed; top: 16px; left: 16px;
  z-index: 300; width: 40px; height: 40px;
  border-radius: 11px; background: var(--surface);
  border: 1px solid var(--border2); backdrop-filter: blur(10px);
  cursor: pointer; align-items: center; justify-content: center;
  font-size: 1rem; color: var(--text); box-shadow: var(--shadow);
}
.overlay-bg { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.3); z-index: 150; }

/* Toast */
.toast {
  position: fixed; bottom: 24px; right: 24px;
  background: var(--teal-dark); color: white;
  padding: 12px 20px; border-radius: 14px;
  font-size: .82rem; font-weight: 600;
  box-shadow: 0 8px 32px rgba(10,182,139,.35);
  z-index: 1000; display: none;
  align-items: center; gap: 8px;
  animation: toastIn .3s ease;
}
.toast.show { display: flex; }
@keyframes toastIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }

/* Responsive */
@media (max-width: 1100px) { .stats-grid { grid-template-columns: repeat(2,1fr); } .main-grid { grid-template-columns: 1fr; } }
@media (max-width: 820px) {
  :root { --sidebar-w: 0px; }
  .sb { transform: translateX(-100%); width: 220px; }
  .sb.open { transform: translateX(0); }
  .main { margin-left: 0; padding: 20px 16px; padding-top: 68px; }
  .hamburger { display: flex; }
  .overlay-bg.show { display: block; }
  .accs-grid { grid-template-columns: 1fr; }
  .budget-page-grid { grid-template-columns: 1fr; }
  .saving-stats { grid-template-columns: 1fr; }
}
@media (max-width: 500px) { .stats-grid { grid-template-columns: 1fr; } }

/* Pulse dot animation */
@keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:.5; } }
.live-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--teal); display: inline-block; animation: pulse 2s infinite; margin-right: 5px; }

/* Number counter animation */
.count-up { transition: all .4s; }
</style>
</head>
<body>

<button class="hamburger" onclick="toggleSidebar()">‚ò∞</button>
<div class="overlay-bg" id="overlayBg" onclick="toggleSidebar()"></div>

<!-- SIDEBAR -->
<nav class="sb" id="sidebar">
  <div class="sb-logo">
    <div class="sb-logo-mark">üí∞</div>
    <div class="sb-logo-text">Dompet<em>Ku</em></div>
  </div>
  <div class="sb-nav">
    <div class="sb-section">Utama</div>
    <div class="sb-item active" onclick="showPage('dashboard',this)">
      <span class="sb-icon">‚äû</span>Dashboard
    </div>
    <div class="sb-item" onclick="showPage('transaksi',this)">
      <span class="sb-icon">‚â°</span>Riwayat
    </div>
    <div class="sb-item" onclick="showPage('akun',this)">
      <span class="sb-icon">‚ñ£</span>Akun & Dompet
    </div>
    <div class="sb-section">Keuangan</div>
    <div class="sb-item" onclick="showPage('budget',this)">
      <span class="sb-icon">‚óé</span>Budget
    </div>
    <div class="sb-item" onclick="showPage('saving',this)">
      <span class="sb-icon">‚óà</span>Tabungan
    </div>
  </div>
  <div class="sb-bottom">
    <div class="user-card">
      <div class="avatar">U</div>
      <div>
        <div class="user-name">User</div>
        <div class="user-role">Personal Account</div>
      </div>
    </div>
  </div>
</nav>

<!-- MAIN -->
<div class="main">

  <!-- ‚îÄ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ‚îÄ -->
  <div class="page active" id="page-dashboard">
    <div class="topbar">
      <div class="topbar-left">
        <div class="greeting"><span class="live-dot"></span><span id="current-datetime">‚Äî</span></div>
        <div class="page-title">Dashboard üëã</div>
      </div>
      <div class="topbar-right">
        <div class="period-tabs">
          <div class="ptab active" onclick="setPeriod('hari',this)">Hari</div>
          <div class="ptab" onclick="setPeriod('minggu',this)">Minggu</div>
          <div class="ptab" onclick="setPeriod('bulan',this)">Bulan</div>
        </div>
        <button class="btn btn-primary" onclick="openModal()">Ôºã Tambah</button>
      </div>
    </div>

    <!-- STATS -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon-wrap" style="background:rgba(10,182,139,.1)">üíö</div>
        <div class="stat-label">Total Saldo</div>
        <div class="stat-value count-up" id="total-balance">Rp 0</div>
        <div class="stat-badge badge-green">Semua akun</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon-wrap" style="background:rgba(10,182,139,.1)">‚Üì</div>
        <div class="stat-label">Pemasukan</div>
        <div class="stat-value count-up" id="total-income" style="color:var(--income)">Rp 0</div>
        <div class="stat-badge badge-green" id="income-period">Periode ini</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon-wrap" style="background:rgba(240,78,110,.08)">‚Üë</div>
        <div class="stat-label">Pengeluaran</div>
        <div class="stat-value count-up" id="total-expense" style="color:var(--expense)">Rp 0</div>
        <div class="stat-badge badge-red" id="expense-period">Periode ini</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon-wrap" style="background:rgba(124,92,252,.1)">‚óà</div>
        <div class="stat-label">Tabungan</div>
        <div class="stat-value count-up" id="total-saving" style="color:var(--saving)">Rp 0</div>
        <div class="stat-badge badge-purple">Total saving</div>
      </div>
    </div>

    <!-- MAIN GRID -->
    <div class="main-grid">
      <!-- LEFT -->
      <div>
        <div class="hero-card">
          <div class="hero-label">Total Kekayaan Bersih</div>
          <div class="hero-amount" id="net-worth">Rp 0</div>
          <div class="hero-date" id="bal-date">‚Äî</div>
          <div class="hero-stats">
            <div>
              <div class="hero-stat-label">Masuk</div>
              <div class="hero-stat-val" id="bal-income">Rp 0</div>
            </div>
            <div>
              <div class="hero-stat-label">Keluar</div>
              <div class="hero-stat-val" id="bal-expense">Rp 0</div>
            </div>
            <div>
              <div class="hero-stat-label">Selisih</div>
              <div class="hero-stat-val" id="bal-diff">Rp 0</div>
            </div>
          </div>
          <div class="acc-pills" id="acc-tags"></div>
        </div>

        <!-- Chart -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">Pengeluaran 7 Hari</span>
            <span class="card-action" onclick="showPage('transaksi',null)">Lihat semua ‚Üí</span>
          </div>
          <div class="chart-wrap" id="mini-chart">
            <div style="color:var(--muted);font-size:.78rem;align-self:center;width:100%;text-align:center">Belum ada data</div>
          </div>
        </div>

        <!-- Budget Overview -->
        <div class="card" style="margin-top:16px">
          <div class="card-header">
            <span class="card-title">Budget Bulan Ini</span>
            <button class="btn btn-ghost btn-sm" onclick="showPage('budget',null)">Kelola ‚Üí</button>
          </div>
          <div id="budget-overview"></div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="right-col">
        <!-- Notifikasi -->
        <div class="card">
          <div class="card-header"><span class="card-title">‚ö† Notifikasi</span></div>
          <div id="notif-list">
            <div class="empty"><div class="empty-icon">‚úÖ</div><div class="empty-text">Semua budget aman</div></div>
          </div>
        </div>

        <!-- Recent Transactions -->
        <div class="card" style="flex:1">
          <div class="card-header">
            <span class="card-title">Transaksi Terbaru</span>
            <span class="card-action" onclick="showPage('transaksi',null)">Lihat semua ‚Üí</span>
          </div>
          <div id="recent-tx">
            <div class="empty"><div class="empty-icon">üì≠</div><div class="empty-text">Belum ada transaksi</div></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ RIWAYAT ‚îÄ‚îÄ‚îÄ -->
  <div class="page" id="page-transaksi">
    <div class="topbar">
      <div><div class="greeting">Semua Transaksi</div><div class="page-title">Riwayat üìã</div></div>
      <button class="btn btn-primary" onclick="openModal()">Ôºã Tambah</button>
    </div>
    <div class="filter-row">
      <div class="search-wrap">
        <span style="color:var(--muted)">‚åï</span>
        <input type="text" id="search-input" placeholder="Cari transaksi..." oninput="renderHistory()">
      </div>
      <select class="filter-sel" id="filter-type" onchange="renderHistory()">
        <option value="">Semua Tipe</option>
        <option value="masuk">Pemasukan</option>
        <option value="keluar">Pengeluaran</option>
      </select>
      <select class="filter-sel" id="filter-cat" onchange="renderHistory()">
        <option value="">Semua Kategori</option>
        <option value="saving">Tabungan</option>
        <option value="daily">Keseharian</option>
        <option value="lifestyle">Lifestyle</option>
        <option value="play">Hiburan</option>
        <option value="lainnya">Lainnya</option>
      </select>
      <select class="filter-sel" id="filter-acc" onchange="renderHistory()">
        <option value="">Semua Akun</option>
      </select>
      <select class="filter-sel" id="filter-period" onchange="renderHistory()">
        <option value="">Semua Waktu</option>
        <option value="today">Hari Ini</option>
        <option value="week">Minggu Ini</option>
        <option value="month">Bulan Ini</option>
      </select>
    </div>
    <div class="card">
      <div id="history-list">
        <div class="empty"><div class="empty-icon">üì≠</div><div class="empty-text">Belum ada transaksi</div></div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ AKUN ‚îÄ‚îÄ‚îÄ -->
  <div class="page" id="page-akun">
    <div class="topbar">
      <div><div class="greeting">Kelola Dompet</div><div class="page-title">Akun & Dompet üí≥</div></div>
      <button class="btn btn-primary" onclick="openAccModal()">Ôºã Tambah Akun</button>
    </div>
    <div class="accs-grid" id="acc-list"></div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ BUDGET ‚îÄ‚îÄ‚îÄ -->
  <div class="page" id="page-budget">
    <div class="topbar">
      <div><div class="greeting">Atur Jatah Per Kategori</div><div class="page-title">Budget üìä</div></div>
      <button class="btn btn-primary" onclick="saveBudgets()">üíæ Simpan</button>
    </div>
    <div class="budget-page-grid">
      <div class="card">
        <div class="card-header"><span class="card-title">Atur Budget Bulanan</span></div>
        <p style="font-size:.8rem;color:var(--muted);margin-bottom:18px;line-height:1.6">Set jatah pengeluaran per kategori. Notifikasi otomatis saat 50%, 70%, dan 80%.</p>
        <div class="form-group"><label class="form-label">üíú Tabungan</label><input type="text" class="form-input" id="budget-saving" placeholder="Rp 0" oninput="formatBudgetInput(this)"></div>
        <div class="form-group"><label class="form-label">üå§ Keseharian</label><input type="text" class="form-input" id="budget-daily" placeholder="Rp 0" oninput="formatBudgetInput(this)"></div>
        <div class="form-group"><label class="form-label">üåø Lifestyle</label><input type="text" class="form-input" id="budget-lifestyle" placeholder="Rp 0" oninput="formatBudgetInput(this)"></div>
        <div class="form-group"><label class="form-label">üéÆ Hiburan</label><input type="text" class="form-input" id="budget-play" placeholder="Rp 0" oninput="formatBudgetInput(this)"></div>
        <div class="form-group"><label class="form-label">üì¶ Lainnya</label><input type="text" class="form-input" id="budget-lainnya" placeholder="Rp 0" oninput="formatBudgetInput(this)"></div>
      </div>
      <div class="card">
        <div class="card-header"><span class="card-title">Progres Bulan Ini</span></div>
        <div id="budget-progress-page"></div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ SAVING ‚îÄ‚îÄ‚îÄ -->
  <div class="page" id="page-saving">
    <div class="topbar">
      <div><div class="greeting">Pantau Tabunganmu</div><div class="page-title">Tabungan üè¶</div></div>
      <button class="btn btn-primary" onclick="openModal()">Ôºã Catat</button>
    </div>
    <div class="saving-stats">
      <div class="stat-card">
        <div class="stat-icon-wrap" style="background:rgba(124,92,252,.1)">‚óà</div>
        <div class="stat-label">Total Tabungan</div>
        <div class="stat-value" id="sv-total" style="color:var(--saving)">Rp 0</div>
        <div class="stat-badge badge-purple">Semua waktu</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon-wrap" style="background:rgba(10,182,139,.1)">‚Üë</div>
        <div class="stat-label">Bulan Ini</div>
        <div class="stat-value" id="sv-month" style="color:var(--income)">Rp 0</div>
        <div class="stat-badge badge-green">Tabungan baru</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon-wrap" style="background:rgba(255,125,69,.1)">‚óé</div>
        <div class="stat-label">Target Budget</div>
        <div class="stat-value" id="sv-target" style="color:var(--lifestyle)">‚Äî</div>
        <div class="stat-badge" style="background:rgba(255,125,69,.1);color:var(--lifestyle)">Per bulan</div>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><span class="card-title">Riwayat Tabungan</span></div>
      <div id="saving-list"><div class="empty"><div class="empty-icon">üè¶</div><div class="empty-text">Belum ada catatan</div></div></div>
    </div>
  </div>

</div><!-- end main -->

<!-- MODAL TRANSAKSI -->
<div class="modal-overlay" id="modal" onclick="closeModalOutside(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title">Catat Transaksi</div>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="type-toggle">
        <div class="type-btn income active" onclick="setType('masuk',this)">‚Üì Pemasukan</div>
        <div class="type-btn expense" onclick="setType('keluar',this)">‚Üë Pengeluaran</div>
      </div>
      <div class="form-group">
        <label class="form-label">Nominal</label>
        <input type="text" class="form-input" id="tx-amount" placeholder="Rp 0" oninput="formatAmountInput(this)">
      </div>
      <div class="form-group">
        <label class="form-label" id="keterangan-label">Dari Siapa</label>
        <input type="text" class="form-input" id="tx-keterangan" placeholder="contoh: Gaji dari PT Maju">
      </div>
      <div class="form-group">
        <label class="form-label">Kategori</label>
        <select class="form-select" id="tx-kategori">
          <option value="daily">üå§ Keseharian</option>
          <option value="lifestyle">üåø Lifestyle</option>
          <option value="play">üéÆ Hiburan</option>
          <option value="saving">üíú Tabungan</option>
          <option value="lainnya">üì¶ Lainnya</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Akun / Dompet</label>
        <select class="form-select" id="tx-akun"></select>
      </div>
      <div class="form-group">
        <label class="form-label">Tanggal & Jam</label>
        <div class="datetime-box" id="tx-datetime">‚Äî</div>
      </div>
      <button class="btn btn-primary" style="width:100%;justify-content:center" onclick="addTransaction()">‚úÖ Simpan Transaksi</button>
    </div>
  </div>
</div>

<!-- MODAL AKUN -->
<div class="modal-overlay" id="acc-modal" onclick="closeAccModalOutside(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title">Tambah Akun</div>
      <button class="modal-close" onclick="closeAccModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-group"><label class="form-label">Nama Akun</label><input type="text" class="form-input" id="acc-name" placeholder="BCA, DANA, Dompet Cash..."></div>
      <div class="form-group">
        <label class="form-label">Ikon</label>
        <select class="form-select" id="acc-icon">
          <option value="üíµ">üíµ Cash</option><option value="üè¶">üè¶ Bank BCA</option>
          <option value="üíô">üíô Bank BNI</option><option value="‚ù§Ô∏è">‚ù§Ô∏è Bank Mandiri</option>
          <option value="üíõ">üíõ Bank BRI</option><option value="üì±">üì± DANA</option>
          <option value="üíö">üíö GoPay</option><option value="üü£">üü£ OVO</option>
          <option value="üí≥">üí≥ Lainnya</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Saldo Awal</label><input type="text" class="form-input" id="acc-init" placeholder="Rp 0" oninput="formatAmountInput(this)"></div>
      <div class="form-group">
        <label class="form-label">Warna Aksen</label>
        <select class="form-select" id="acc-color">
          <option value="#0ab68b">Teal</option><option value="#7c5cfc">Indigo</option>
          <option value="#ff7d45">Orange</option><option value="#e91e8c">Pink</option>
          <option value="#2196f3">Blue</option><option value="#10b981">Green</option>
        </select>
      </div>
      <button class="btn btn-primary" style="width:100%;justify-content:center" onclick="addAccount()">‚úÖ Tambah Akun</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"><span id="toast-msg">Tersimpan!</span></div>

<script>
// ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ
let transactions = JSON.parse(localStorage.getItem('dku_tx')||'[]');
let accounts = JSON.parse(localStorage.getItem('dku_acc')||'[]');
let budgets = JSON.parse(localStorage.getItem('dku_budgets')||'{}');
let currentPeriod = 'hari';
let currentType = 'masuk';

if(!accounts.length){
  accounts=[{id:1,name:'Cash',icon:'üíµ',color:'#0ab68b',init:0},{id:2,name:'BCA',icon:'üè¶',color:'#2196f3',init:0},{id:3,name:'DANA',icon:'üì±',color:'#e91e8c',init:0}];
  saveAccounts();
}

function saveTx(){localStorage.setItem('dku_tx',JSON.stringify(transactions))}
function saveAccounts(){localStorage.setItem('dku_acc',JSON.stringify(accounts))}
function saveBudgetStore(){localStorage.setItem('dku_budgets',JSON.stringify(budgets))}

const catCfg={
  saving:{label:'Tabungan',icon:'üíú',color:'var(--saving)'},
  daily:{label:'Keseharian',icon:'üå§',color:'var(--daily)'},
  lifestyle:{label:'Lifestyle',icon:'üåø',color:'var(--lifestyle)'},
  play:{label:'Hiburan',icon:'üéÆ',color:'var(--play)'},
  lainnya:{label:'Lainnya',icon:'üì¶',color:'var(--muted)'},
};
const catColors={saving:'#7c5cfc',daily:'#2196f3',lifestyle:'#ff7d45',play:'#e91e8c',lainnya:'#7eaaa0'};

function fmt(n){if(isNaN(n)||n===null||n===undefined)return'Rp 0';return'Rp '+Math.abs(n).toLocaleString('id-ID');}
function fmtRaw(s){return parseInt(s.replace(/\D/g,''))||0;}
function formatAmountInput(el){let v=el.value.replace(/\D/g,'');el.value=v?'Rp '+parseInt(v).toLocaleString('id-ID'):'';}
function formatBudgetInput(el){let v=el.value.replace(/\D/g,'');el.value=v?'Rp '+parseInt(v).toLocaleString('id-ID'):'';}
function getInputVal(el){return fmtRaw(el.value);}
function nowStr(){return new Date().toISOString();}
function fmtDate(iso){const d=new Date(iso);return d.toLocaleDateString('id-ID',{day:'2-digit',month:'short',year:'numeric'})+' '+d.toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'});}
function isToday(iso){const d=new Date(iso),n=new Date();return d.toDateString()===n.toDateString();}
function isThisWeek(iso){const d=new Date(iso),n=new Date();const s=new Date(n);s.setDate(n.getDate()-n.getDay());s.setHours(0,0,0,0);return d>=s;}
function isThisMonth(iso){const d=new Date(iso),n=new Date();return d.getMonth()===n.getMonth()&&d.getFullYear()===n.getFullYear();}

// Nav
function showPage(id,el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  document.querySelectorAll('.sb-item').forEach(i=>i.classList.remove('active'));
  if(el)el.classList.add('active');
  if(id==='dashboard')renderDashboard();
  if(id==='transaksi')renderHistory();
  if(id==='akun')renderAccounts();
  if(id==='budget')renderBudgetPage();
  if(id==='saving')renderSavingPage();
  closeSidebarMobile();
}
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open');document.getElementById('overlayBg').classList.toggle('show');}
function closeSidebarMobile(){if(window.innerWidth<=820){document.getElementById('sidebar').classList.remove('open');document.getElementById('overlayBg').classList.remove('show');}}
function setPeriod(p,el){currentPeriod=p;document.querySelectorAll('.ptab').forEach(t=>t.classList.remove('active'));el.classList.add('active');renderDashboard();}
function filterByPeriod(list){if(currentPeriod==='hari')return list.filter(t=>isToday(t.date));if(currentPeriod==='minggu')return list.filter(t=>isThisWeek(t.date));return list.filter(t=>isThisMonth(t.date));}

// Modal
let dtInterval;
function openModal(){
  clearInterval(dtInterval);
  updateDatetime();
  dtInterval=setInterval(updateDatetime,1000);
  const sel=document.getElementById('tx-akun');
  sel.innerHTML=accounts.map(a=>`<option value="${a.id}">${a.icon} ${a.name}</option>`).join('');
  document.getElementById('modal').classList.add('show');
}
function closeModal(){clearInterval(dtInterval);document.getElementById('modal').classList.remove('show');}
function closeModalOutside(e){if(e.target===document.getElementById('modal'))closeModal();}
function updateDatetime(){const el=document.getElementById('tx-datetime');if(el)el.textContent=fmtDate(new Date().toISOString());}
function setType(type,el){currentType=type;document.querySelectorAll('.type-btn').forEach(b=>b.classList.remove('active'));el.classList.add('active');document.getElementById('keterangan-label').textContent=type==='masuk'?'Dari Siapa':'Keperluan';}
function openAccModal(){document.getElementById('acc-modal').classList.add('show');}
function closeAccModal(){document.getElementById('acc-modal').classList.remove('show');}
function closeAccModalOutside(e){if(e.target===document.getElementById('acc-modal'))closeAccModal();}

function addTransaction(){
  const amt=getInputVal(document.getElementById('tx-amount'));
  const ket=document.getElementById('tx-keterangan').value.trim();
  const cat=document.getElementById('tx-kategori').value;
  const accId=parseInt(document.getElementById('tx-akun').value);
  if(!amt){showToast('‚ùå Masukkan nominal!');return;}
  if(!ket){showToast('‚ùå Isi keterangan!');return;}
  const tx={id:Date.now(),type:currentType,amount:amt,keterangan:ket,kategori:cat,accId,date:nowStr()};
  transactions.unshift(tx);saveTx();
  document.getElementById('tx-amount').value='';
  document.getElementById('tx-keterangan').value='';
  closeModal();checkBudgetNotif(cat,tx);renderDashboard();
  showToast('‚úÖ Transaksi disimpan!');
}
function addAccount(){
  const name=document.getElementById('acc-name').value.trim();
  const icon=document.getElementById('acc-icon').value;
  const init=getInputVal(document.getElementById('acc-init'));
  const color=document.getElementById('acc-color').value;
  if(!name){showToast('‚ùå Isi nama akun!');return;}
  accounts.push({id:Date.now(),name,icon,color,init});saveAccounts();
  document.getElementById('acc-name').value='';document.getElementById('acc-init').value='';
  closeAccModal();renderAccounts();renderDashboard();
  showToast('‚úÖ Akun ditambahkan!');
}

function getAccBalance(accId){
  const acc=accounts.find(a=>a.id===accId);const init=acc?acc.init:0;
  const txs=transactions.filter(t=>t.accId===accId);
  return init+txs.filter(t=>t.type==='masuk').reduce((s,t)=>s+t.amount,0)-txs.filter(t=>t.type==='keluar').reduce((s,t)=>s+t.amount,0);
}
function getTotalBalance(){return accounts.reduce((s,a)=>s+getAccBalance(a.id),0);}
function getPeriodTotals(){const list=filterByPeriod(transactions);return{income:list.filter(t=>t.type==='masuk').reduce((s,t)=>s+t.amount,0),expense:list.filter(t=>t.type==='keluar').reduce((s,t)=>s+t.amount,0)};}
function getBudgetSpent(cat){return transactions.filter(t=>t.type==='keluar'&&t.kategori===cat&&isThisMonth(t.date)).reduce((s,t)=>s+t.amount,0);}

// Render Dashboard
function renderDashboard(){
  const p=getPeriodTotals();const totalBal=getTotalBalance();
  const savTx=transactions.filter(t=>t.kategori==='saving'&&t.type==='masuk');
  const totalSaving=savTx.reduce((s,t)=>s+t.amount,0);
  document.getElementById('total-balance').textContent=fmt(totalBal);
  document.getElementById('total-income').textContent=fmt(p.income);
  document.getElementById('total-expense').textContent=fmt(p.expense);
  document.getElementById('total-saving').textContent=fmt(totalSaving);
  document.getElementById('net-worth').textContent=fmt(totalBal);
  document.getElementById('bal-income').textContent=fmt(p.income);
  document.getElementById('bal-expense').textContent=fmt(p.expense);
  document.getElementById('bal-diff').textContent=fmt(p.income-p.expense);
  const pl={'hari':'Hari Ini','minggu':'Minggu Ini','bulan':'Bulan Ini'}[currentPeriod];
  document.getElementById('income-period').textContent=pl;
  document.getElementById('expense-period').textContent=pl;
  document.getElementById('bal-date').textContent=new Date().toLocaleDateString('id-ID',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
  document.getElementById('acc-tags').innerHTML=accounts.map(a=>`<div class="acc-pill">${a.icon} ${a.name}: ${fmt(getAccBalance(a.id))}</div>`).join('');
  renderRecentTx();renderMiniChart();renderBudgetOverview();renderNotifications();
}

function txItemHTML(t){
  const acc=accounts.find(a=>a.id===t.accId);
  const cat=catCfg[t.kategori]||catCfg.lainnya;
  const isIn=t.type==='masuk';
  return `<div class="tx-item">
    <div class="tx-icon-wrap" style="background:${isIn?'rgba(10,182,139,.1)':'rgba(240,78,110,.08)'}">${cat.icon}</div>
    <div class="tx-body">
      <div class="tx-name">${t.keterangan}</div>
      <div class="tx-meta"><span class="tx-cat-tag">${cat.label}</span><span>${acc?acc.icon+' '+acc.name:'‚Äî'}</span></div>
    </div>
    <div class="tx-right">
      <div class="tx-amount" style="color:${isIn?'var(--income)':'var(--expense)'}">${isIn?'+':'-'}${fmt(t.amount)}</div>
      <div class="tx-time">${fmtDate(t.date)}</div>
    </div>
  </div>`;
}
function renderRecentTx(){
  const el=document.getElementById('recent-tx');
  const recent=transactions.slice(0,5);
  el.innerHTML=recent.length?recent.map(t=>txItemHTML(t)).join(''):'<div class="empty"><div class="empty-icon">üì≠</div><div class="empty-text">Belum ada transaksi</div></div>';
}

function renderMiniChart(){
  const el=document.getElementById('mini-chart');
  const days=[];
  for(let i=6;i>=0;i--){const d=new Date();d.setDate(d.getDate()-i);const ds=d.toDateString();const total=transactions.filter(t=>t.type==='keluar'&&new Date(t.date).toDateString()===ds).reduce((s,t)=>s+t.amount,0);days.push({label:d.toLocaleDateString('id-ID',{weekday:'short'}),val:total});}
  const max=Math.max(...days.map(d=>d.val),1);
  if(days.every(d=>d.val===0)){el.innerHTML='<div style="color:var(--muted);font-size:.75rem;align-self:center;width:100%;text-align:center">Belum ada data pengeluaran</div>';return;}
  el.innerHTML=days.map((d,i)=>{
    const h=Math.max((d.val/max)*58,3);
    const isToday2=i===6;
    return `<div class="chart-bar-col">
      <div class="chart-bar" style="height:${h}px;background:${isToday2?'linear-gradient(to top,var(--teal-dark),var(--teal2))':'linear-gradient(to top,rgba(10,182,139,.35),rgba(10,182,139,.55))'};"></div>
      <div class="chart-bar-label">${d.label}</div>
    </div>`;
  }).join('');
}

function renderBudgetOverview(){
  const el=document.getElementById('budget-overview');
  const cats=['saving','daily','lifestyle','play','lainnya'];
  const items=cats.map(c=>{const limit=budgets[c]||0;const spent=getBudgetSpent(c);const cfg=catCfg[c];if(!limit&&!spent)return null;const pct=limit?Math.min((spent/limit)*100,100):0;return{c,limit,spent,cfg,pct};}).filter(Boolean);
  if(!items.length){el.innerHTML='<div class="empty"><div class="empty-icon">üìä</div><div class="empty-text">Atur budget dulu di menu Budget</div></div>';return;}
  el.innerHTML=`<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:14px">${items.map(({c,limit,spent,cfg,pct})=>`
    <div class="budget-row">
      <div class="budget-head">
        <div class="budget-cat"><div class="budget-dot" style="background:${catColors[c]}"></div>${cfg.icon} ${cfg.label}</div>
        <div class="budget-pct" style="color:${pct>=80?'var(--expense)':pct>=50?'var(--lifestyle)':'var(--income)'}">${Math.round(pct)}%</div>
      </div>
      <div class="budget-track"><div class="budget-fill" style="width:${pct}%;background:${pct>=80?'var(--expense)':pct>=50?'var(--lifestyle)':catColors[c]}"></div></div>
      <div class="budget-foot"><span>${fmt(spent)}</span><span>${limit?fmt(limit):'Belum diset'}</span></div>
    </div>`).join('')}</div>`;
}

function renderNotifications(){
  const el=document.getElementById('notif-list');
  const cats=['saving','daily','lifestyle','play','lainnya'];
  const notifs=[];
  cats.forEach(c=>{const limit=budgets[c];if(!limit)return;const spent=getBudgetSpent(c);const pct=(spent/limit)*100;const cfg=catCfg[c];if(pct>=80)notifs.push({icon:'üî¥',cat:cfg.label,pct,msg:'Hampir habis!',color:'var(--expense)'});else if(pct>=50)notifs.push({icon:'üü°',cat:cfg.label,pct,msg:'Sudah setengah',color:'var(--lifestyle)'});else if(pct>=30)notifs.push({icon:'üü¢',cat:cfg.label,pct,msg:'Masih aman',color:'var(--income)'});});
  el.innerHTML=notifs.length?notifs.map(n=>`<div class="notif-item"><div class="notif-dot" style="background:${n.color}"></div><div><div class="notif-text">${n.icon} ${n.cat} ‚Äî ${Math.round(n.pct)}%</div><div class="notif-sub">${n.msg}</div></div></div>`).join(''):'<div class="empty"><div class="empty-icon">‚úÖ</div><div class="empty-text">Semua budget aman</div></div>';
}

function checkBudgetNotif(cat,tx){
  if(tx.type!=='keluar')return;const limit=budgets[cat];if(!limit)return;
  const spent=getBudgetSpent(cat);const pct=(spent/limit)*100;const cfg=catCfg[cat]||catCfg.lainnya;
  if(pct>=80)showToast(`üî¥ ${cfg.label}: ${Math.round(pct)}% terpakai!`);
  else if(pct>=50)showToast(`üü° ${cfg.label}: 50% terpakai`);
}

function renderHistory(){
  const search=document.getElementById('search-input').value.toLowerCase();
  const typeF=document.getElementById('filter-type').value;
  const catF=document.getElementById('filter-cat').value;
  const accF=document.getElementById('filter-acc').value;
  const periodF=document.getElementById('filter-period').value;
  const accSel=document.getElementById('filter-acc');const prev=accSel.value;
  accSel.innerHTML='<option value="">Semua Akun</option>'+accounts.map(a=>`<option value="${a.id}">${a.icon} ${a.name}</option>`).join('');
  if(prev)accSel.value=prev;
  let list=[...transactions];
  if(search)list=list.filter(t=>t.keterangan.toLowerCase().includes(search));
  if(typeF)list=list.filter(t=>t.type===typeF);
  if(catF)list=list.filter(t=>t.kategori===catF);
  if(accF)list=list.filter(t=>t.accId===parseInt(accF));
  if(periodF==='today')list=list.filter(t=>isToday(t.date));
  if(periodF==='week')list=list.filter(t=>isThisWeek(t.date));
  if(periodF==='month')list=list.filter(t=>isThisMonth(t.date));
  const el=document.getElementById('history-list');
  el.innerHTML=list.length?list.map(t=>`<div style="position:relative" onmouseenter="this.querySelector('.del-btn').style.display='flex'" onmouseleave="this.querySelector('.del-btn').style.display='none'">
    ${txItemHTML(t)}
    <button onclick="deleteTx(${t.id})" class="del-btn" style="position:absolute;right:0;top:50%;transform:translateY(-50%);width:27px;height:27px;border-radius:50%;background:rgba(240,78,110,.1);border:none;cursor:pointer;font-size:.72rem;color:var(--expense);display:none;align-items:center;justify-content:center">‚úï</button>
  </div>`).join(''):'<div class="empty"><div class="empty-icon">üîç</div><div class="empty-text">Tidak ada transaksi</div></div>';
}
function deleteTx(id){if(!confirm('Hapus transaksi ini?'))return;transactions=transactions.filter(t=>t.id!==id);saveTx();renderHistory();renderDashboard();showToast('üóëÔ∏è Dihapus');}

function renderAccounts(){
  const el=document.getElementById('acc-list');
  el.innerHTML=accounts.length?accounts.map((a,i)=>{const bal=getAccBalance(a.id);const cnt=transactions.filter(t=>t.accId===a.id).length;return `<div class="acc-card-big" style="animation-delay:${i*.07}s">
    <div class="acc-logo-big" style="background:${a.color}18">${a.icon}</div>
    <div style="flex:1"><div class="acc-card-name">${a.name}</div><div class="acc-card-num">${cnt} transaksi</div></div>
    <div><div class="acc-card-bal" style="color:${a.color}">${fmt(bal)}</div><div class="acc-card-type">Saldo saat ini</div></div>
  </div>`;}
  ).join(''):'<div class="empty"><div class="empty-icon">üí≥</div><div class="empty-text">Belum ada akun</div></div>';
}

function renderBudgetPage(){
  const cats=['saving','daily','lifestyle','play','lainnya'];
  cats.forEach(c=>{const el=document.getElementById('budget-'+c);if(budgets[c])el.value='Rp '+budgets[c].toLocaleString('id-ID');});
  const el=document.getElementById('budget-progress-page');
  el.innerHTML=cats.map(c=>{const limit=budgets[c]||0;const spent=getBudgetSpent(c);const cfg=catCfg[c];const pct=limit?Math.min((spent/limit)*100,100):0;return `<div class="budget-row">
    <div class="budget-head"><div class="budget-cat"><div class="budget-dot" style="background:${catColors[c]}"></div>${cfg.icon} ${cfg.label}</div><div class="budget-pct" style="color:${pct>=80?'var(--expense)':pct>=50?'var(--lifestyle)':'var(--income)'}">${Math.round(pct)}%</div></div>
    <div class="budget-track"><div class="budget-fill" style="width:${pct}%;background:${pct>=80?'var(--expense)':pct>=50?'var(--lifestyle)':catColors[c]}"></div></div>
    <div class="budget-foot"><span>${fmt(spent)}</span><span>${limit?fmt(limit):'Belum diset'}</span></div>
  </div>`}).join('');
}
function saveBudgets(){const cats=['saving','daily','lifestyle','play','lainnya'];cats.forEach(c=>{budgets[c]=getInputVal(document.getElementById('budget-'+c));});saveBudgetStore();renderBudgetPage();renderDashboard();showToast('‚úÖ Budget disimpan!');}

function renderSavingPage(){
  const savTx=transactions.filter(t=>t.kategori==='saving');
  const total=savTx.filter(t=>t.type==='masuk').reduce((s,t)=>s+t.amount,0)-savTx.filter(t=>t.type==='keluar').reduce((s,t)=>s+t.amount,0);
  const month=savTx.filter(t=>t.type==='masuk'&&isThisMonth(t.date)).reduce((s,t)=>s+t.amount,0);
  document.getElementById('sv-total').textContent=fmt(total);
  document.getElementById('sv-month').textContent=fmt(month);
  document.getElementById('sv-target').textContent=budgets.saving?fmt(budgets.saving):'Belum diset';
  const list=savTx.sort((a,b)=>new Date(b.date)-new Date(a.date));
  const el=document.getElementById('saving-list');
  el.innerHTML=list.length?list.map(t=>txItemHTML(t)).join(''):'<div class="empty"><div class="empty-icon">üè¶</div><div class="empty-text">Belum ada catatan</div></div>';
}

function showToast(msg){
  const t=document.getElementById('toast');
  document.getElementById('toast-msg').textContent=msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),3000);
}

// Clock
function updateClock(){
  const el=document.getElementById('current-datetime');
  if(el){const d=new Date();el.textContent=d.toLocaleDateString('id-ID',{weekday:'long',day:'numeric',month:'long',year:'numeric'})+' ‚Ä¢ '+d.toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit',second:'2-digit'});}
}
setInterval(updateClock,1000);updateClock();
renderDashboard();
</script>
</body>
</html>
